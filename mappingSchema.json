{
  "$schema": "https://json-schema.org/draft-07/schema",
  "type": "object",
  "description": "Schema for resource mapping\n",
  "additionalProperties": false,
  "required": [
      "mappings"
  ],
  "definitions": {
      "subPub": {
          "type": "object",
          "anyOf": [
              {
                  "properties": {
                      "endpoint": {
                        "type": "string"
                      }
                  },
                  "required": [
                      "endpoint"
                  ]
              },
              {
                  "properties": {
                      "topic": {
                        "type": "string"
                      }
                  },
                  "required": [
                      "topic"
                  ]
              }
          ],
          "additionalProperties": false,
          "properties": {
              "endpoint": {
                  "$id": "properties/endpoint",
                  "type": "string"
              },
              "topic": {
                  "$id": "properties/topic",
                  "type": "string"
              },
              "connection": {
                  "type": "string"
              },
              "qos": {
                  "type": "integer",
                  "default": 0,
                  "description": "Quality of service for mqtt messages"
              },
              "retain": {
                  "type": "boolean",
                  "default": false,
                  "description": "Whether the last message should be retained (last-value-cached) on the internal broker"
              },
              "label": {
                  "type": "string",
                  "description": "A label to be used when subscribing to multiple endpoints in a single mapping"
              }
          }
      },
      "CybusRule": {
        "$ref": "./objects/CybusRule.json"
      }
  },
  "properties": {
      "agentName": {
          "type": "string",
          "default": "protocol-mapper"
      },
      "mappings": {
          "type": "array",
          "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                  "subscribe",
                  "publish"
              ],
              "properties": {
                  "subscribe": {
                      "anyOf": [
                          {
                              "$ref": "#/definitions/subPub"
                          },
                          {
                              "type": "array",
                              "items": {
                                  "$ref": "#/definitions/subPub"
                              }
                          }
                      ]
                  },
                  "publish": {
                      "$ref": "#/definitions/subPub"
                  },
                  "rules": {
                      "type": "array",
                      "items": {
                          "$ref": "#/definitions/CybusRule"
                      }
                  }
              }
          }
      },
      "targetState": {
          "type": "string",
          "enum": [
              "enabled",
              "disabled"
          ],
          "default": "enabled"
      },
      "inputBuffering": {
          "type": "object",
          "title": "Input buffering properties",
          "description": "Properties to define the behaviour of the input buffering",
          "additionalProperties": false,
          "properties": {
              "enabled": {
                  "title": "Enable Buffering",
                  "type": "boolean",
                  "description": "Whether input buffering should be enabled or not",
                  "default": false
              },
              "maxConcurrentMessages": {
                  "title": "Maximum concurrent messages",
                  "type": "integer",
                  "description": "Maximum number of concurrently processed messages as long as the input buffer queue is non-empty.",
                  "default": 2
              },
              "maxInputBufferSize": {
                  "title": "Maximum input buffer size",
                  "type": "integer",
                  "description": "Maximum number of input messages that are queued in the input buffer. Exceeding messages will be discarded. Adjust this to a higher value if you are handling bursty traffic.",
                  "default": 5000
              },
              "waitingTimeOnEmptyQueue": {
                  "title": "Waiting time during empty queue",
                  "type": "integer",
                  "description": "Waiting time in milliseconds after the input buffer queue ran empty and before checking again for newly queued input messages. Regardless of this value, on non-empty input buffer queue all messages will be processed without waiting time in between until the queue is empty again.",
                  "default": 10
              }
          }
      },
      "rules":{
        "$ref": "#/definitions/CybusRule"
      }
  }
}